{"version":3,"file":"bundle.umd.js","sources":["../src/pollingLink.ts"],"sourcesContent":["import {\n  ApolloLink,\n  Operation,\n  NextLink,\n  FetchResult,\n  Observable,\n} from 'apollo-link';\n\nexport namespace PollingLink {\n  /**\n   * Frequency (in milliseconds) that an operation should be polled on.\n   */\n  export interface PollInterval {\n    (operation: Operation): number | null;\n  }\n}\n\nexport class PollingLink extends ApolloLink {\n  private pollInterval: PollingLink.PollInterval;\n  private timer;\n  private subscription: ZenObservable.Subscription;\n\n  constructor(pollInterval: PollingLink.PollInterval) {\n    super();\n    this.pollInterval = pollInterval;\n  }\n\n  public request(\n    operation: Operation,\n    forward: NextLink,\n  ): Observable<FetchResult> {\n    return new Observable(observer => {\n      const subscriber = {\n        next: data => {\n          observer.next(data);\n        },\n        error: error => observer.error(error),\n      };\n\n      const poll = () => {\n        this.subscription.unsubscribe();\n        this.subscription = forward(operation).subscribe(subscriber);\n      };\n\n      const interval = this.pollInterval(operation);\n      if (interval !== null) {\n        this.timer = setInterval(poll, interval);\n      }\n\n      this.subscription = forward(operation).subscribe(subscriber);\n\n      return () => {\n        if (this.timer) {\n          clearInterval(this.timer);\n        }\n        this.subscription.unsubscribe();\n      };\n    });\n  }\n}\n"],"names":["Observable","ApolloLink"],"mappings":";;;;;;;;;;;;;;;;AAAA;QAiBiC,+BAAU;QAKzC,qBAAY,YAAsC;YAAlD,YACE,iBAAO,SAER;YADC,KAAI,CAAC,YAAY,GAAG,YAAY,CAAC;;SAClC;QAEM,6BAAO,GAAd,UACE,SAAoB,EACpB,OAAiB;YAFnB,iBA+BC;YA3BC,OAAO,IAAIA,qBAAU,CAAC,UAAA,QAAQ;gBAC5B,IAAM,UAAU,GAAG;oBACjB,IAAI,EAAE,UAAA,IAAI;wBACR,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;qBACrB;oBACD,KAAK,EAAE,UAAA,KAAK,IAAI,OAAA,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,GAAA;iBACtC,CAAC;gBAEF,IAAM,IAAI,GAAG;oBACX,KAAI,CAAC,YAAY,CAAC,WAAW,EAAE,CAAC;oBAChC,KAAI,CAAC,YAAY,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;iBAC9D,CAAC;gBAEF,IAAM,QAAQ,GAAG,KAAI,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;gBAC9C,IAAI,QAAQ,KAAK,IAAI,EAAE;oBACrB,KAAI,CAAC,KAAK,GAAG,WAAW,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;iBAC1C;gBAED,KAAI,CAAC,YAAY,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;gBAE7D,OAAO;oBACL,IAAI,KAAI,CAAC,KAAK,EAAE;wBACd,aAAa,CAAC,KAAI,CAAC,KAAK,CAAC,CAAC;qBAC3B;oBACD,KAAI,CAAC,YAAY,CAAC,WAAW,EAAE,CAAC;iBACjC,CAAC;aACH,CAAC,CAAC;SACJ;QACH,kBAAC;IAAD,CAAC,CA1CgCC,qBAAU;;;;;;;;;;;;"}