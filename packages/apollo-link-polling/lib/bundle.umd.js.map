{"version":3,"file":"bundle.umd.js","sources":["../src/pollingLink.ts"],"sourcesContent":["import {\n  ApolloLink,\n  Operation,\n  NextLink,\n  FetchResult,\n  Observable,\n} from 'apollo-link';\n\nexport namespace PollingLink {\n  /**\n   * Frequency (in milliseconds) that an operation should be polled on.\n   */\n  export interface PollInterval {\n    (operation: Operation): number | null;\n  }\n}\n\nexport class PollingLink extends ApolloLink {\n  private pollInterval: PollingLink.PollInterval;\n  private timer;\n  private subscription: ZenObservable.Subscription;\n\n  constructor(pollInterval: PollingLink.PollInterval) {\n    super();\n    this.pollInterval = pollInterval;\n  }\n\n  public request(\n    operation: Operation,\n    forward: NextLink,\n  ): Observable<FetchResult> {\n    return new Observable(observer => {\n      const subscriber = {\n        next: data => {\n          observer.next(data);\n        },\n        error: error => observer.error(error),\n      };\n\n      const poll = () => {\n        this.subscription.unsubscribe();\n        this.subscription = forward(operation).subscribe(subscriber);\n      };\n\n      const interval = this.pollInterval(operation);\n      if (interval !== null) {\n        this.timer = setInterval(poll, interval);\n      }\n\n      this.subscription = forward(operation).subscribe(subscriber);\n\n      return () => {\n        if (this.timer) {\n          clearInterval(this.timer);\n        }\n        this.subscription.unsubscribe();\n      };\n    });\n  }\n}\n"],"names":["tslib_1.__extends","Observable","ApolloLink"],"mappings":";;;;;;;MAiBiCA,uCAAU;MAKzC,qBAAY,YAAsC;UAAlD,YACE,iBAAO,SAER;UADC,KAAI,CAAC,YAAY,GAAG,YAAY,CAAC;;OAClC;MAEM,6BAAO,GAAd,UACE,SAAoB,EACpB,OAAiB;UAFnB,iBA+BC;UA3BC,OAAO,IAAIC,qBAAU,CAAC,UAAA,QAAQ;cAC5B,IAAM,UAAU,GAAG;kBACjB,IAAI,EAAE,UAAA,IAAI;sBACR,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;mBACrB;kBACD,KAAK,EAAE,UAAA,KAAK,IAAI,OAAA,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,GAAA;eACtC,CAAC;cAEF,IAAM,IAAI,GAAG;kBACX,KAAI,CAAC,YAAY,CAAC,WAAW,EAAE,CAAC;kBAChC,KAAI,CAAC,YAAY,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;eAC9D,CAAC;cAEF,IAAM,QAAQ,GAAG,KAAI,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;cAC9C,IAAI,QAAQ,KAAK,IAAI,EAAE;kBACrB,KAAI,CAAC,KAAK,GAAG,WAAW,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;eAC1C;cAED,KAAI,CAAC,YAAY,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;cAE7D,OAAO;kBACL,IAAI,KAAI,CAAC,KAAK,EAAE;sBACd,aAAa,CAAC,KAAI,CAAC,KAAK,CAAC,CAAC;mBAC3B;kBACD,KAAI,CAAC,YAAY,CAAC,WAAW,EAAE,CAAC;eACjC,CAAC;WACH,CAAC,CAAC;OACJ;MACH,kBAAC;EAAD,CA1CA,CAAiCC,qBAAU;;;;;;;;;;;;"}