{"version":3,"file":"bundle.esm.js","sources":["../src/pollingLink.ts"],"sourcesContent":["import {\n  ApolloLink,\n  Operation,\n  NextLink,\n  FetchResult,\n  Observable,\n} from 'apollo-link';\n\nexport namespace PollingLink {\n  /**\n   * Frequency (in milliseconds) that an operation should be polled on.\n   */\n  export interface PollInterval {\n    (operation: Operation): number | null;\n  }\n}\n\nexport class PollingLink extends ApolloLink {\n  private pollInterval: PollingLink.PollInterval;\n  private timer;\n  private subscription: ZenObservable.Subscription;\n\n  constructor(pollInterval: PollingLink.PollInterval) {\n    super();\n    this.pollInterval = pollInterval;\n  }\n\n  public request(\n    operation: Operation,\n    forward: NextLink,\n  ): Observable<FetchResult> {\n    return new Observable(observer => {\n      const subscriber = {\n        next: data => {\n          observer.next(data);\n        },\n        error: error => observer.error(error),\n      };\n\n      const poll = () => {\n        this.subscription.unsubscribe();\n        this.subscription = forward(operation).subscribe(subscriber);\n      };\n\n      const interval = this.pollInterval(operation);\n      if (interval !== null) {\n        this.timer = setInterval(poll, interval);\n      }\n\n      this.subscription = forward(operation).subscribe(subscriber);\n\n      return () => {\n        if (this.timer) {\n          clearInterval(this.timer);\n        }\n        this.subscription.unsubscribe();\n      };\n    });\n  }\n}\n"],"names":["tslib_1.__extends"],"mappings":";;;;IAiBiCA,+BAAU;IAKzC,qBAAY,YAAsC;QAAlD,YACE,iBAAO,SAER;QADC,KAAI,CAAC,YAAY,GAAG,YAAY,CAAC;;KAClC;IAEM,6BAAO,GAAd,UACE,SAAoB,EACpB,OAAiB;QAFnB,iBA+BC;QA3BC,OAAO,IAAI,UAAU,CAAC,UAAA,QAAQ;YAC5B,IAAM,UAAU,GAAG;gBACjB,IAAI,EAAE,UAAA,IAAI;oBACR,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;iBACrB;gBACD,KAAK,EAAE,UAAA,KAAK,IAAI,OAAA,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,GAAA;aACtC,CAAC;YAEF,IAAM,IAAI,GAAG;gBACX,KAAI,CAAC,YAAY,CAAC,WAAW,EAAE,CAAC;gBAChC,KAAI,CAAC,YAAY,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;aAC9D,CAAC;YAEF,IAAM,QAAQ,GAAG,KAAI,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;YAC9C,IAAI,QAAQ,KAAK,IAAI,EAAE;gBACrB,KAAI,CAAC,KAAK,GAAG,WAAW,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;aAC1C;YAED,KAAI,CAAC,YAAY,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;YAE7D,OAAO;gBACL,IAAI,KAAI,CAAC,KAAK,EAAE;oBACd,aAAa,CAAC,KAAI,CAAC,KAAK,CAAC,CAAC;iBAC3B;gBACD,KAAI,CAAC,YAAY,CAAC,WAAW,EAAE,CAAC;aACjC,CAAC;SACH,CAAC,CAAC;KACJ;IACH,kBAAC;AAAD,CA1CA,CAAiC,UAAU;;;;"}